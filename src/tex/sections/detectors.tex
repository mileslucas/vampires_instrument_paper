\section{Detectors}\label{sec:detectors}

For our upgrades we deployed two custom-modified \textit{Hamamatsu ORCA-Quest} qCMOS detectors\footnote{\url{https://www.hamamatsu.com/us/en/product/cameras/qcmos-cameras/C15550-20UP.html}}. These detectors were chosen for their fast readout ($\sim$500 Hz at 512x512), low read noise ($\sim$ 0.2 - 0.4 $e^-$ RMS), and high dynamic range ($\sim$ 85 - 90 \si{\decibel}). We modified the cameras to be compatible with the telescope glycol cooling loop which keeps the detectors at \SIrange{-45}{-40}{\celsius} without creating turbulence in the instrument from air cooling.

The detectors have two  readout modes: the full-speed ``FAST'' mode, and the slower, but more sensitive, ``SLOW'' mode. In ``FAST'' mode there is an electronic shutter that allows detector integration times (DIT) of \SI{7.2}{\micro\second} - \SI{1800}{\second}. In ``SLOW'' mode the DIT is limited to $\gtrsim$\SI{50}{\milli\second}, depending on the camera crop. In this mode the analog to digital converters benefit from the reduced readout rate to reach $\sim$0.2 $e^-$ RMS read noise.

The detectors have rolling-shutter readout that exposes four pixel rows at a time. The maximum framerate is limited by the number of rows read out and the readout speed described previously. In addition, the rolling-shutter effect becomes more prevalent at the shortest DITs and the duty cycle gets lower and lower. At the extreme, each group of four pixel rows will not be exposed until after the preceding group has been read out. As an additional complication, when using the hardware trigger the detectors have reduced framerates and duty cycle, below 50\% in some scenarios, to enable consistent timings for synchronization between both cameras.

\subsection{Detector Characterization}

We measured a photon transfer curve using a calibration flat field source for both detectors in both readout modes using a non-polarizing beamsplitter cube. We removed the fixed-pattern noise through frame-differencing before performing a linear fit between the average signal and the signal variance. From this fit we extract the gain in \si{\electron/\second}. We measure the readout noise from the standard deviation of a bias frame and convert to \si{\electron} with the gain. We observe that the full well (\SI{7000}{\electron}) is greater than the maximum bit-depth with our measured detector gain. The detector photoresponse is linear over the entire dynamic range and saturates at $2^{16}$ \si{adu}. During commissioning we also took dark frames with the detector caps covered. For data with significant signal, we performed a linear fit of the signal to the exposure time to get the average dark current per pixel. We report our results in \autoref{tbl:detectors}.

We compare the sensitivity of the qCMOS detectors to the EM-CCD detectors in \autoref{fig:detector_snr} and \autoref{fig:detector_snr_relative}. These signal-to-noise (S/N) curves use calibrated read noise, dark current, and gain along with manufacturer quantum efficiency (QE) values averaged over \SIrange{600}{800}{nm}. When EM gain is enabled, we add a excess noise factor of $\sqrt{2}$. The qCMOS have an order of magnitude worse dark current and slightly worse QE compared to the EMCCDs. Despite this, we see from \autoref{fig:detector_snr_relative} that the qCMOS detectors have better performance than the EMCCDs when photon noise or read-noise limited, in general. The qCMOS detectors are dark-limited (in ``SLOW'' mode) at $\sim$\SI{15}{s} where the relative performance in the low-flux regime drops compared to the EMCCDs. Using the EMCCDs without EM gain outperforms both the qCMOS and EMCCD with EM gain at high photon fluxes due to the lack of excess noise factor combined with higher QE.

Overall, our detectors are some of the most sensitive available commercially today. Compared to electron-multiplication technologies, the calibration and operation of the detectors is much simpler. In addition, the previous installment of VAMPIRES did not allow exposure times $>$\SI{1}{s}, so our new detector architecture is vastly more flexible and sensitive than before. We recommend flat-fielding to correct for the pixel-to-pixel gain variations that are much higher in CMOS detectors. The bias frames are quite structured due to the CMOS architecture, so we also recommend bias or sky-background frames for subtracting the structured offset. Other than that, the detectors are virtually free of cosmetics so we only apply bad-pixel correction to long exposures for cosmic-ray rejection.

\begin{deluxetable}{cccccc}
\tablehead{
    \multirow{2}{*}{Cam} & 
    \multirow{2}{*}{Mode} & 
    \colhead{Gain} & 
    \colhead{RN} & 
    \colhead{DC} & 
    \colhead{DR} \\
     &
     &
    \colhead{(\si{\electron/\adu})} &
    \colhead{(\si{\electron})} &
    \colhead{(\si{\electron/\second/\pixel})} &
    \colhead{(\si{\decibel})}
}
\tablecaption{VAMPIRES detector characteristics. Dynamic range (DR) derived from max signal ($2^{16}$ \si{\adu} $\approx$ \SI{6800}{\electron}) divided by the readout noise.\label{tbl:detectors}}
\startdata
VCAM1 & FAST & 0.103 & 0.40 & \num{3.6e-3} & 85 \\
VCAM1 & SLOW & 0.105 & 0.25 & \num{3.6e-3} & 90 \\
VCAM2 & FAST & 0.103 & 0.40 & \num{3.6e-3} & 85 \\
VCAM2 & SLOW & 0.105 & 0.22 & \num{3.6e-3} & 90 \\
\enddata
\end{deluxetable}


\begin{figure}
    \centering
    \script{detector_snr.py}
    \includegraphics[width=\columnwidth]{figures/detector_snr.pdf}
    \caption{Theoretical S/N curves for the new CMOS detectors (red curves) and the previous EMCCD detectors (blue curves). The top plot shows a read noise-limited case, and the bottom plot shows a dark-limited case. Noise terms include read noise, dark noise, photon noise, and excess noise factor for the EMCCDs.\label{fig:detector_snr}}
\end{figure}


\begin{figure}
    \centering
    \script{detector_snr.py}
    \includegraphics[width=\columnwidth]{figures/detector_snr_relative.pdf}
    \caption{Theoretical normalized S/N curves for the new CMOS detectors (red curves) and the previous EMCCD detectors (blue curves). The curves are normalized to an ideal camera (shot-noise only with perfect QE). The top plot shows a read noise-limited case, and the bottom plot shows a dark-limited case. Noise terms include read noise, dark noise, photon noise, and excess noise factor for the EMCCDs.\label{fig:detector_snr_relative}}
\end{figure}


\subsection{Astrometric Calibration}

TODO